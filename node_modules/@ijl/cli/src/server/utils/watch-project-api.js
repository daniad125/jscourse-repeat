const fs = require('fs');
const chalk = require('chalk');

const invalidateApi = require('./invalidate-api');
const safeConnectApi = require('./safe-connect-api');

let watchId = null;
module.exports = (app, location) => {
    const watch = () => {
        clearTimeout(watchId);
        watchId = setTimeout(() => {
            invalidateApi(location);
            safeConnectApi(app, location);
            console.log(chalk.green('api updated'));
        }, 200);
    }
    safeConnectApi(app, location);

    fs.watch(location, { recursive: true }, watch);
}
